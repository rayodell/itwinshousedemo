(this["webpackJsonpsample-home-app"]=this["webpackJsonpsample-home-app"]||[]).push([[3],{1061:function(e,t,a){"use strict";a.r(t);a(486);var i=a(304),n=a(0),o=a.n(n),r=a(44),s=a.n(r),c=(a(491),a(5)),d=a(6),l=a(1104),m=a(349),h=a(351),u=a(350),w=a(189),p=a(469);const v=Object(p.a)();var g=a(3);class SmartDeviceAPI{static async GetData(){return(await fetch("https://smarthomedata.z22.web.core.windows.net/")).json()}}class smartdevicemarkers_SmartDeviceMarker extends c.Marker{constructor(e,t,a,i,n,o){super(e,t),this._smartDeviceId=void 0,this._devicetype=void 0,this._elementid=void 0,this._smartDeviceId=a,this._devicetype=i,this._elementid=o,this.setImageUrl(`/${this._devicetype}.png`),this.title=this.populateTitle(n)}populateTitle(e){let t="";for(const[i,n]of Object.entries(e))t+=`\n            <tr>\n                <th>${i}</th>\n                <th>${n}</th>\n            </tr>\n            `;const a=document.createElement("div");return a.className="smart-table",a.innerHTML=`\n        <h3>${this._smartDeviceId}</h3>\n        <table>\n        ${t}\n        </table>\n        `,a}onMouseButton(e){return e.isDown||(c.IModelApp.notifications.outputMessage(new c.NotifyMessageDetails(c.OutputMessagePriority.Info,"Element "+this._smartDeviceId+" was clicked on")),c.IModelApp.viewManager.selectedView.zoomToElements(this._elementid,{animateFrustumChange:!0,standardViewId:c.StandardViewId.RightIso})),!0}}class smartdevicedecorator_SmartDeviceDecorator{constructor(e){this._imodel=void 0,this._markerset=void 0,this._imodel=e.iModel,this._markerset=[],this.addMarkers()}async getSmartDeviceData(){const e=this._imodel.query("Select SmartDeviceID,SmartDeviceType,Origin,ECInstanceId FROM DgnCustomItemTypes_HouseSchema.SmartDevice WHERE Origin is not null",void 0,{rowFormat:g.QueryRowFormat.UseJsPropertyNames}),t=[];for await(const a of e)console.log(a),t.push(a);return t}async addMarkers(){const e=await this.getSmartDeviceData(),t=await SmartDeviceAPI.GetData();e.forEach((e=>{const a=new smartdevicemarkers_SmartDeviceMarker({x:e.origin.x,y:e.origin.y,z:e.origin.z},{x:40,y:40},e.smartDeviceId,e.smartDeviceType,t[e.smartDeviceId],e.id);this._markerset.push(a)}))}decorate(e){this._markerset.forEach((t=>t.addDecoration(e)))}}var b=a(164);var src_App=()=>{const[e,t]=Object(n.useState)("3b310652-e30c-40c1-bde4-6fec0ddcd139"),[a,o]=Object(n.useState)("ef520845-8c60-4372-9366-590fb0e974ed"),r=Object(w.f)(),s=Object(n.useMemo)((()=>{var e,t,a;return new i.b({scope:null!==(e="imodelaccess:read imodels:read realitydata:read")?e:"",clientId:null!==(t="spa-ie0IYHL13VBHp6A4t7wdxvppz")?t:"",redirectUri:null!==(a="http://localhost:3000/signin-callback")?a:"",postSignoutRedirectUri:"http://localhost:3000/logout",responseType:"code",authority:"https://ims.bentley.com"})}),[]),p=Object(n.useCallback)((async()=>{try{await s.signInSilent()}catch{await s.signIn()}}),[s]);Object(n.useEffect)((()=>{p()}),[p]),Object(n.useEffect)((()=>{if(r){const e=new URLSearchParams(window.location.search);e.has("iTwinId")&&o(e.get("iTwinId")),e.has("iModelId")&&t(e.get("iModelId"))}}),[r]),Object(n.useEffect)((()=>{r&&a&&e&&v.push(`?iTwinId=${a}&iModelId=${e}`)}),[r,a,e]);const I=Object(n.useCallback)((e=>{new Promise(((t,a)=>{const i=new Date,n=setInterval((()=>{e.areAllTileTreesLoaded&&(w.d.addMark("TilesLoaded"),w.d.addMeasure("TileTreesLoaded","ViewerStarting","TilesLoaded"),clearInterval(n),t(!0)),(new Date).getTime()-i.getTime()>2e4&&a()}),100)})).finally((()=>{c.IModelApp.tools.run(c.FitViewTool.toolId,e,!0,!1),e.view.setStandardRotation(c.StandardViewId.Iso)}))}),[]),y=Object(n.useMemo)((()=>({viewportConfigurer:I})),[I]),D=Object(n.useCallback)((async()=>{await u.a.initialize(),await h.a.initialize(),await m.a.startup()}),[]);return Object(b.jsxs)("div",{className:"viewer-container",children:[!r&&Object(b.jsx)(d.r,{children:Object(b.jsx)("div",{className:"signin-content",children:Object(b.jsx)(l.a,{indeterminate:!0,labels:["Signing in..."]})})}),Object(b.jsx)(w.a,{iTwinId:null!==a&&void 0!==a?a:"",iModelId:null!==e&&void 0!==e?e:"",authClient:s,viewCreatorOptions:y,enablePerformanceMonitors:!0,onIModelAppInit:D,uiProviders:[new w.c,new w.b({vertical:{measureGroup:!1}}),new w.e,new u.b,new h.b({enableCopyingPropertyText:!0}),new m.b],onIModelConnected:e=>{c.IModelApp.viewManager.onViewOpen.addOnce((async t=>{t.changeCategoryDisplay([],!1);t.overrideDisplayStyle({viewflags:{visEdges:!1,shadows:!0}});const a=`select ecinstanceId from biscore.category where codevalue in (${["'Wall 2nd'","'Wall 1st'","'Dry Wall 2nd'","'Dry Wall 1st'","'Brick Exterior'","'Windows 1st'","'Windows 2nd'","'Ceiling 1st'","'Ceiling 2nd'","'Callouts'","'light fixture'","'Roof'"].toString()})`,i=e.query(a,void 0,{rowFormat:g.QueryRowFormat.UseJsPropertyNames}),n=[];for await(const e of i)n.push(e.id);t.changeCategoryDisplay(n,!1),console.log(await SmartDeviceAPI.GetData()),c.IModelApp.viewManager.addDecorator(new smartdevicedecorator_SmartDeviceDecorator(t))}))}})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));const I=new URL("http://localhost:3000/signin-callback");I.pathname===window.location.pathname?i.a.handleSigninCallback(I.toString()).catch(console.error):s.a.render(Object(b.jsx)(o.a.StrictMode,{children:Object(b.jsx)(src_App,{})}),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()})).catch((e=>{console.error(e.message)}))}()},486:function(e,t,a){},491:function(e,t,a){},533:function(e,t){},538:function(e,t){},544:function(e,t){},546:function(e,t){}},[[1061,5,6]]]);
//# sourceMappingURL=main.b862ea24.chunk.js.map